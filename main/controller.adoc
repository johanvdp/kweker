// The author disclaims copyright to this document.
:toc:
:toc-title: Table of contents
:toclevels: 5
:sectnums:

== Controller

The controller module contains multiple sub-modules.

*Module name: CPU*

.Screw terminals top
[%autowidth]
|===
| pin | function | description

3+| power supply input
| *1.1* | 5V  |
| *1.2* | GND |
|===

.Screw terminals bottom
[%autowidth]
|===
| pin | function | description

3+| *actuators*
| *2.1*  | GND  |
| *2.2*  | OUT1 | output 1 (3.3V)
| *2.3*  | GND  |
| *2.4*  | OUT2 | output 2 (3.3V)
| *2.5*  | GND  |
| *2.6*  | OUT3 | output 3 (3.3V)
| *2.7*  | GND  |
| *2.8*  | OUT4 | output 4 (3.3V)

3+| *humidity & temperature sensor*
| *2.9*  | GND  |
| *2.10* | DATA | 1 wire serial TTL (3.3V)

3+| *CO2 concentration sensor*
| *2.11* | 5V  |
| *2.12* | GND |
| *2.13* | TX  | serial transmit TTL (3.3V)
| *2.14* | RX  | serial receive TTL (3.3V)

|===

=== ESP32 module

*Module name: ESP*

.ESP32 module left
[%autowidth]
|===
| pin  | name | function                 | use
                                         
| *1*  | 3.3V |                          |
| *2*  | EN   |                          | RESET
| *3*  | P36  |                          |
| *4*  | P39  |                          |
| *5*  | P34  |                          |
| *6*  | P35  |                          |
| *7*  | P32  |                          |
| *8*  | P33  |                          |
| *9*  | P25  |                          |
| *10* | P26  |                          |
| *11* | P27  |                          |
| *12* | P14  | HSPICLK(2)               |
| *13* | P12  | HSPIQ(2)                 |
| *14* | GND  |                          |
| *15* | P13  | HSPID(2)                 |
| *16* | P9   | SD_DATA_2(1), *U1RXD*(5) | CO2 RX 2.14
| *17* | P10  | SD_DATA_3(1), *U1TXD*(5) | CO2 TX 2.13
| *18* | P11  | SD_CMD(1)                |
| *19* | 5V   |                          |
|===

.ESP32 module right
[%autowidth]
|===
| pin  | name | function                 | use
                                         
| *38* | GND  |                          | 
| *37* | P23  | *VSPID*(2)               | SPIMOSI LCD & TOUCH
| *36* | P22  | VSPIWP(2)                | TOUCH CS
| *35* | P1   | *U0TXD*(1)               | USB SERIAL
| *34* | P3   | *U0RXD*(1)               | USB SERIAL
| *33* | P21  | VSPIHD(2)                | LCD DC/RS
| *32* | GND  |                          |
| *31* | P19  | *VSPIQ*(2)               | SPIMISO LCD & TOUCH
| *30* | P18  | *VSPICLK*(2)             | SPICLK LCD & TOUCH
| *29* | P5   | VSPICS0(2)               | LCD CS
| *28* | P17  | U2TXD(5)                 |
| *27* | P16  | U2RXD(5)                 |
| *26* | P4   | HSPIHD(2)                | 
| *25* | P0   | *GPIO0*(1,3)             | BOOT
| *24* | P2   | *GPIO2*(1,3), HSPIWP(2)  | LED
| *23* | P15  | HSPICS0(2)               |
| *22* | P8   | SD_DATA_1(1)             |
| *21* | P7   | SD_DATA_O(1)             |
| *20* | P6   | SD_CLK(1)                |
|===

=== User interface module

The user interface is a small 3.5" LCD display with touch screen.
The MSP3520 module is build around a ILI9488 LCD driver, a XPT2046 touch screen controller and communicates using an SPI interface.

*Module name: LCD*

.MSP3520 module
[%autowidth]
|===
| pin  | function  | description

3+| *LCD panel*
| *1.1*  | VCC       | *3.3V*..5V
| *1.2*  | GND       |
| *1.3*  | CS        | LCD chip select
| *1.4*  | RESET     | LCD reset
| *1.5*  | DC/RS     | LCD register / data selection
| *1.6*  | SDI(MOSI) | LCD SPI bus write data
| *1.7*  | SCK       | LCD SPI bus clock
| *1.8*  | LED       | LCD backlight control (3.3V is on)
| *1.9*  | SDO(MISO) | LCD SPI bus read data (optional)

3+| *touch screen*
| *1.10* | T_CLK     | Touch screen SPI bus clock
| *1.11* | T_CS      | Touch screen chip select
| *1.12* | T_DIN     | Touch screen SPI bus write data
| *1.13* | T_DO      | Touch screen SPI bus read data
| *1.14* | T_IRQ     | Touch screen interupt detect

3+| *SD card*
| *2.1*  | SD_CS     | SD card chip select
| *2.2*  | SD_MOSI   | SD card SPI bus write data
| *2.3*  | SD_MISO   | SD card SPI bus read data
| *2.4*  | SD_SCK    | SD card SPI bus clock
|===

.MSP3520 module other
[%autowidth]
|===
| parameter | value

| operating voltage | *3.3V*..5V
| operating current | 90 mA
|===


